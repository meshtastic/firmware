[env:xiao-rp2350-sx1262]
extends = rp2350_base
board = seeed_xiao_rp2350
board_level = extra
upload_protocol = picotool

# Board configuration for XIAO RP2350
board_upload.maximum_size = 2097152     ; 2MB flash (W25Q16)
board_upload.psram_length = 0           ; RP2350 has NO PSRAM
board_build.filesystem_size = 0.5m      ; 512KB for LittleFS

# Variant-specific build flags
build_flags =
  ${rp2350_base.build_flags}
  -D RPI_PICO2
  -D XIAO_RP2350_SX1262
  -D XIAO_USB_CAPTURE_ENABLED
  -I variants/rp2350/xiao-rp2350-sx1262
  -I src/platform/rp2xx0/usb_capture
  -D DEBUG_RP2040_PORT=Serial
  -D HW_SPI0_DEVICE
  -D RADIOLIB_SOFTWARE_SERIAL_UNSUPPORTED

  ; === PERMANENT TAKEOVER CHANNEL CONFIGURATION ===
  ; Secondary channel "takeover" with custom 256-bit PSK
  -D USERPREFS_CHANNEL_1_PSK="{ 0x13, 0xeb, 0x1f, 0x36, 0xc6, 0xd5, 0x10, 0xac, 0x05, 0x99, 0x8f, 0x63, 0xb5, 0xa6, 0xf2, 0x21, 0x6e, 0xfd, 0x97, 0x61, 0x71, 0xa3, 0xf3, 0xe0, 0xd2, 0xe2, 0x63, 0x1f, 0x0c, 0xb9, 0xa1, 0x9d }"
  -D USERPREFS_CHANNEL_1_NAME="\"takeover\""
  -D USERPREFS_CHANNEL_1_UPLINK_ENABLED=true
  -D USERPREFS_CHANNEL_1_DOWNLINK_ENABLED=true

  ; === DEVICE ROLE & LORA CONFIGURATION ===
  ; Set to CLIENT_HIDDEN for stealth operation
  -D USERPREFS_CONFIG_DEVICE_ROLE=meshtastic_Config_DeviceConfig_Role_CLIENT_HIDDEN

  ; LoRa defaults (US region, LongFast preset)
  -D USERPREFS_CONFIG_LORA_REGION=meshtastic_Config_LoRaConfig_RegionCode_US
  -D USERPREFS_LORACONFIG_MODEM_PRESET=meshtastic_Config_LoRaConfig_ModemPreset_LONG_FAST

  ; === TEMPORARY: Force factory reset on next boot ===
  ; Comment out this flag after first successful flash!
  -D FACTORY_INSTALL

  ; === POWER OPTIMIZATION ===
  ; Disable features not needed for sensor node
  -D USERPREFS_BLUETOOTH_ENABLED=false
  -D USERPREFS_GPS_ENABLED=false

lib_deps =
  ${rp2350_base.lib_deps}

debug_build_flags = ${rp2350_base.build_flags}, -g
debug_tool = cmsis-dap
