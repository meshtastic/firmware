; LilyGo T-Deck
[env:t-deck]
extends = esp32s3_base
board = t-deck
board_check = true
upload_protocol = esptool

build_flags = ${esp32s3_base.build_flags} 
  -DT_DECK 
  -DBOARD_HAS_PSRAM
  -DMAX_THREADS=40
  -DGPS_POWER_TOGGLE
  -Ivariants/t-deck

lib_deps = ${esp32s3_base.lib_deps}
	lovyan03/LovyanGFX@^1.2.0
  earlephilhower/ESP8266Audio@^1.9.9
  earlephilhower/ESP8266SAM@^1.0.1


[env:t-deck-tft]
extends = env:t-deck
board_build.partitions = default_16MB.csv

build_flags =
  ${env:t-deck.build_flags}
  -D CONFIG_DISABLE_HAL_LOCKS=1 ; "feels" to be a bit more stable without locks
  -D MESHTASTIC_EXCLUDE_CANNEDMESSAGES=1
  -D MESHTASTIC_EXCLUDE_INPUTBROKER=1
  -D MESHTASTIC_EXCLUDE_WEBSERVER=1
  -D MESHTASTIC_EXCLUDE_SERIAL=1
  -D MESHTASTIC_EXCLUDE_SOCKETAPI=1
  -D INPUTDRIVER_I2C_KBD_TYPE=0x55
  -D INPUTDRIVER_ENCODER_TYPE=3
  -D INPUTDRIVER_ENCODER_LEFT=1
  -D INPUTDRIVER_ENCODER_RIGHT=2
  -D INPUTDRIVER_ENCODER_UP=3
  -D INPUTDRIVER_ENCODER_DOWN=15
  -D INPUTDRIVER_ENCODER_BTN=0
  -D INPUTDRIVER_BUTTON_TYPE=0
  -D MAX_NUM_NODES=250
  -D HAS_SCREEN=0
  -D HAS_TFT=1
  -D USE_I2S_BUZZER
  -D RAM_SIZE=4096
	-D LV_LVGL_H_INCLUDE_SIMPLE
	-D LV_CONF_INCLUDE_SIMPLE
	-D LV_COMP_CONF_INCLUDE_SIMPLE
  -D LV_USE_SYSMON=0
  -D LV_USE_PROFILER=0
  -D LV_USE_PERF_MONITOR=0
  -D LV_USE_MEM_MONITOR=0
  -D LV_USE_LOG=0
  -D USE_LOG_DEBUG
  -D LOG_DEBUG_INC=\"DebugConfiguration.h\"
  -D RADIOLIB_DEBUG_BASIC=0
  -D RADIOLIB_DEBUG_SPI=0
  -D RADIOLIB_DEBUG_PROTOCOL=0
  -D RADIOLIB_SPI_PARANOID=0
  -D CALIBRATE_TOUCH=0
  -D LGFX_DRIVER=LGFX_TDECK
  -D GFX_DRIVER_INC=\"graphics/LGFX/LGFX_T_DECK.h\"
;  -D LVGL_DRIVER=LVGL_TDECK
;  -D GFX_DRIVER_INC=\"graphics/LVGL/LVGL_T_DECK.h\"
;  -D LV_USE_ST7789=1
  -D VIEW_320x240
;	-D USE_DOUBLE_BUFFER
  -D USE_PACKET_API
	-I lib/device-ui/generated/ui_320x240

build_src_filter =
  ${env:t-deck.build_src_filter}
  +<../lib/device-ui/generated/ui_320x240>
  +<../lib/device-ui/resources>
  +<../lib/device-ui/locale>
  +<../lib/device-ui/source>

lib_deps =
  ${env:t-deck.lib_deps}
